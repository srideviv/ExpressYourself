<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script type='text/javascript' src='https://www.google.com/jsapi'></script>
<script type ="text/javascript">
	
	var geocoder;
	var address;
	var country;

  	if (navigator.geolocation) {
    		navigator.geolocation.getCurrentPosition(successFunction, errorFunction);
	}	 
        // Get latitude and longitude;
	function successFunction(position) {
    		var lat = position.coords.latitude;
    		var lng = position.coords.longitude;
    		getAddress(lat, lng)
	}
	function errorFunction(){
	
	}

	function getAddress(lat, lng) {

    		var latlng = new google.maps.LatLng(lat, lng);
    		geocoder.geocode({'latLng': latlng}, function(results, status) {
      		if (status == google.maps.GeocoderStatus.OK) {
        		if (results[1]) {
				address = results[0].formatted_address;
             			for (var i=0; i<results[0].address_components.length; i++) {
            				for (var j=0;j<results[0].address_components[i].types.length;j++) {
                				if (results[0].address_components[i].types[j] == "country") {
                    					country= results[0].address_components[i].long_name;
							break;
                				}
            				}
        			}
			} else {
 			         alert("No results found");
        		  }
      		} else {
        		alert("Geocoder failed due to: " + status);
      		}
    	        });
  	} 

        function update() {
                $.ajax({
                        type: 'POST',
                        url: 'update',
                        dataType: 'json',
                        data: {poll_id: <%= @poll.id %>},
                        success: function(json, status, xhr){
                        alert(json.message);
                        }
                        });
        }

        $(document).ready(function () {
                        window.onload = function () {
                        update();
	                setInterval(function(){update()},10000);
                        };
                        });


                function onSubmit(opt){
				$.ajax({
                        		type: 'POST',
                        		url: '/clicks',
                        		data: {poll_id: <%= @poll.id %>,
					       option:opt,
					       loc:address,
					       country:country },
					success:function(data, textStatus) {
						document.getElementById("messages").innerHTML="<p style='color:red'>Thanks Buddy !! </p>";
    					},
    					error:function(request, textStatus, errorThrown) {
						document.getElementById("messages").innerHTML="<p style='color:red'>Chill Buddy !!  Get some fresh air </p>";
					}
                        	});

			}
                </script>

<h1 class = "question" > <%= @poll.question %> </h1>
<div id = 'data_set'></div>
<input type="button" value = "<%= @poll.option1 %>" id ="option1" onclick="onSubmit(1)">
<input type="button" value = "<%= @poll.option2 %>" id ="option2" onclick="onSubmit(2)">
